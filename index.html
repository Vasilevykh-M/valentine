<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞</title>
  <style>
    :root{
      --bg1:#ff5f8a;
      --bg2:#7c4dff;

      --text: rgba(255,255,255,.92);
      --ink: #2a1630;
      --inkMuted: rgba(42,22,48,.72);

      /* –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–±–µ–∂–∫–∏ (—Å –ø—Ä—ã–∂–∫–∞–º–∏ –≤ –∫–æ–Ω—Ü–µ) */
      --runDur: 4200ms;

      /* –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –∫–æ—Ç–∞ (–∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π) */
      --catSize: clamp(180px, 28vmin, 320px);

      /* –∫–æ–Ω–µ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–∞–¥–∞–ø—Ç–∏–≤–Ω–æ: —Ç–µ–ª–µ—Ñ–æ–Ω—ã/–Ω–æ—É—Ç—ã/–º–æ–Ω–∏—Ç–æ—Ä—ã) */
      --catEndX: clamp(-260px, -22vw, -120px);
      --catEndY: clamp(140px, 28vh, 260px);

      /* –∫–æ–Ω–≤–µ—Ä—Ç –≤ "–∑—É–±–∞—Ö" —Å —Ç–µ–º –∂–µ —Å–º–µ—â–µ–Ω–∏–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ç–∞ */
      --envEndX: clamp(-10px, 2vw, 40px);
      --envEndY: clamp(170px, 32vh, 300px);

      /* –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ç–∞ –ø–æ—Å–ª–µ ‚Äú–¥–æ—Å—Ç–∞–≤–∫–∏‚Äù (–≤–ª–µ–≤–æ, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–ª –∫–æ–Ω–≤–µ—Ä—Ç) */
      --catDeliverX: clamp(-420px, -38vw, -220px);
      --catDeliverY: clamp(220px, 34vh, 360px);

      /* –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Ç–∞ –ø–æ—Å–ª–µ ‚Äú–¥–æ—Å—Ç–∞–≤–∫–∏‚Äù */
      --envDeliverY: clamp(150px, 28vh, 230px);

      /* –≤—ã—Å–æ—Ç–∞ –ø—Ä—ã–∂–∫–∞ */
      --hopUp: 34px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      min-height:100dvh;
      margin:0;
      color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
      overflow:hidden;
      background:
        radial-gradient(1200px 800px at 15% 15%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(900px 700px at 85% 25%, rgba(255,255,255,.12), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
    }

    body::before{
      content:"";
      position:fixed; inset:0;
      pointer-events:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.12'/%3E%3C/svg%3E");
      mix-blend-mode:overlay;
      opacity:.45;
    }

    #confetti{
      position:fixed; inset:0;
      width:100%; height:100%;
      pointer-events:none;
      z-index: 6;
    }

    /* floating hearts */
    .hearts{ position:fixed; inset:0; pointer-events:none; overflow:hidden; z-index:0; }
    .h{
      position:absolute;
      bottom:-40px;
      font-size: 18px;
      opacity:0;
      filter: drop-shadow(0 10px 16px rgba(0,0,0,.18));
      animation: floatUp linear forwards;
      will-change: transform, opacity;
    }
    @keyframes floatUp{
      0%{ transform: translateY(0) translateX(0) scale(.9); opacity:0 }
      10%{opacity:.85}
      80%{opacity:.75}
      100%{ transform: translateY(-120vh) translateX(var(--dx)) scale(1.25); opacity:0 }
    }

    .wrap{ position:relative; height:100%; min-height:100dvh; display:grid; place-items:center; padding: calc(18px + env(safe-area-inset-top)) calc(18px + env(safe-area-inset-right)) calc(18px + env(safe-area-inset-bottom)) calc(18px + env(safe-area-inset-left)); z-index:1; }
    .stage{ width:100%; height:100%; position:relative; }

    /* ===== CAT ===== */
    .catWrap{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%) translate3d(var(--catEndX), var(--catEndY), 0);
      z-index: 3;
      pointer-events:auto;
      filter: drop-shadow(0 18px 32px rgba(0,0,0,.24));
      will-change: transform;
    }

    /* –ø—Ä–æ–±–µ–≥ + 3 –ø—Ä—ã–∂–∫–∞ –≤ –∫–æ–Ω—Ü–µ */
    .stage.isArriving .catWrap{
      animation: catRunAcross var(--runDur) cubic-bezier(.22,1,.36,1) forwards;
    }

    @keyframes catRunAcross{
      0%   { transform: translate(-50%,-50%) translate3d(-130vw, var(--catEndY), 0) rotate(-1.2deg); }
      60%  { transform: translate(-50%,-50%) translate3d(var(--catEndX), var(--catEndY), 0) rotate(0deg); }

      /* hop 1 */
      68%  { transform: translate(-50%,-50%) translate3d(var(--catEndX), calc(var(--catEndY) - var(--hopUp)), 0) rotate(0deg); }
      74%  { transform: translate(-50%,-50%) translate3d(var(--catEndX), var(--catEndY), 0) rotate(0deg); }

      /* hop 2 */
      80%  { transform: translate(-50%,-50%) translate3d(var(--catEndX), calc(var(--catEndY) - var(--hopUp)), 0) rotate(0deg); }
      86%  { transform: translate(-50%,-50%) translate3d(var(--catEndX), var(--catEndY), 0) rotate(0deg); }

      /* hop 3 */
      92%  { transform: translate(-50%,-50%) translate3d(var(--catEndX), calc(var(--catEndY) - var(--hopUp)), 0) rotate(0deg); }
      98%  { transform: translate(-50%,-50%) translate3d(var(--catEndX), var(--catEndY), 0) rotate(0deg); }
      100% { transform: translate(-50%,-50%) translate3d(var(--catEndX), var(--catEndY), 0) rotate(0deg); }
    }

    .stage.delivered .catWrap{
      animation: none;
      transform: translate(-50%,-50%) translate3d(var(--catDeliverX), var(--catDeliverY), 0) scale(.96);
      opacity: .98;
      transition: transform 900ms cubic-bezier(.2,.9,.2,1);
    }

    .catBtn{ appearance:none; border:none; background:transparent; padding:0; cursor:pointer; display:block; outline:none; }
    .catSvg{ width: var(--catSize); height:auto; display:block; }

    .stage.isArriving .catSvg,
    .stage.arrived:not(.delivered) .catSvg{
      animation: catBob 380ms ease-in-out infinite;
      transform-origin: 50% 80%;
    }
    @keyframes catBob{
      0%,100%{ transform: translateY(0) }
      50%{ transform: translateY(-4px) }
    }

    .leg{ transform-box: fill-box; transform-origin: 50% 10%; will-change: transform; }
    .stage.isArriving .leg.a,
    .stage.arrived:not(.delivered) .leg.a{ animation: stepA 380ms ease-in-out infinite; }
    .stage.isArriving .leg.b,
    .stage.arrived:not(.delivered) .leg.b{ animation: stepB 380ms ease-in-out infinite; }

    @keyframes stepA{
      0%{transform: translateX(-2px) translateY(0px) rotate(9deg)}
      25%{transform: translateX(2px) translateY(-3px) rotate(-6deg)}
      50%{transform: translateX(4px) translateY(0px) rotate(-9deg)}
      75%{transform: translateX(0px) translateY(2px) rotate(6deg)}
      100%{transform: translateX(-2px) translateY(0px) rotate(9deg)}
    }
    @keyframes stepB{
      0%{transform: translateX(4px) translateY(0px) rotate(-9deg)}
      25%{transform: translateX(0px) translateY(2px) rotate(6deg)}
      50%{transform: translateX(-2px) translateY(0px) rotate(9deg)}
      75%{transform: translateX(2px) translateY(-3px) rotate(-6deg)}
      100%{transform: translateX(4px) translateY(0px) rotate(-9deg)}
    }

    .tail{ transform-box: fill-box; transform-origin: 15% 60%; will-change: transform; }
    .stage.isArriving .tail,
    .stage.arrived:not(.delivered) .tail{ animation: tailWag 900ms ease-in-out infinite; }
    @keyframes tailWag{ 0%,100%{transform: rotate(8deg)} 50%{transform: rotate(-10deg)} }

    .eyeRclosed{ opacity:0; }
    .stage.wink .eyeRopen{ opacity:0; }
    .stage.wink .eyeRclosed{ opacity:1; }

    /* ===== ENVELOPE ===== */
    .envelopeWrap{
      position:absolute;
      left:50%;
      top:50%;
      transform: translate(-50%,-50%) translate3d(var(--envEndX), var(--envEndY), 0) scale(.56) rotate(-10deg);
      z-index: 4;
      will-change: transform;
      transition: transform 1000ms cubic-bezier(.18,.92,.18,1);
      filter: drop-shadow(0 20px 48px rgba(0,0,0,.26));
    }

    /* –ø—Ä–æ–±–µ–≥ + —Ç–µ –∂–µ 3 –ø—Ä—ã–∂–∫–∞, —á—Ç–æ–±—ã –∫–æ–Ω–≤–µ—Ä—Ç ‚Äú–≤ –∑—É–±–∞—Ö‚Äù –Ω–µ –æ—Ç—Å—Ç–∞–≤–∞–ª */
    .stage.isArriving .envelopeWrap{
      animation: envRunAcross var(--runDur) cubic-bezier(.22,1,.36,1) forwards;
    }
    @keyframes envRunAcross{
      0%   { transform: translate(-50%,-50%) translate3d(calc(-130vw + 210px), var(--envEndY), 0) scale(.56) rotate(-10deg); }
      60%  { transform: translate(-50%,-50%) translate3d(var(--envEndX), var(--envEndY), 0) scale(.56) rotate(-10deg); }

      68%  { transform: translate(-50%,-50%) translate3d(var(--envEndX), calc(var(--envEndY) - var(--hopUp)), 0) scale(.56) rotate(-10deg); }
      74%  { transform: translate(-50%,-50%) translate3d(var(--envEndX), var(--envEndY), 0) scale(.56) rotate(-10deg); }

      80%  { transform: translate(-50%,-50%) translate3d(var(--envEndX), calc(var(--envEndY) - var(--hopUp)), 0) scale(.56) rotate(-10deg); }
      86%  { transform: translate(-50%,-50%) translate3d(var(--envEndX), var(--envEndY), 0) scale(.56) rotate(-10deg); }

      92%  { transform: translate(-50%,-50%) translate3d(var(--envEndX), calc(var(--envEndY) - var(--hopUp)), 0) scale(.56) rotate(-10deg); }
      98%  { transform: translate(-50%,-50%) translate3d(var(--envEndX), var(--envEndY), 0) scale(.56) rotate(-10deg); }
      100% { transform: translate(-50%,-50%) translate3d(var(--envEndX), var(--envEndY), 0) scale(.56) rotate(-10deg); }
    }

    .stage.delivered .envelopeWrap{
      animation:none;
      transform: translate(-50%,-50%) translate3d(0, var(--envDeliverY), 0) scale(1) rotate(0deg);
    }

    .stage.open .envelopeWrap{
      transform: translate(-50%,-50%) translate3d(0, calc(50vh - 180px), 0) scale(.98) rotate(0deg);
    }

    .envelope{
      width: min(560px, 92vw);
      height: clamp(240px, 42vw, 320px);
      position:relative;
      border-radius: 26px;
      cursor: pointer;
      outline:none;
    }

    .envBack{
      position:absolute; inset:0;
      border-radius: 26px;
      background:
        radial-gradient(240px 180px at 20% 20%, rgba(255,255,255,.55), transparent 60%),
        linear-gradient(180deg, #fff2f7, #ffe7ef);
      border: 1px solid rgba(120,40,90,.14);
      box-shadow: 0 18px 52px rgba(0,0,0,.14);
    }

    .envPocket{
      position:absolute;
      left: 18px; right: 18px; bottom: 18px;
      height: 66%;
      border-radius: 18px 18px 22px 22px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.0), rgba(0,0,0,.03)),
        linear-gradient(180deg, #ffe8f0, #ffd8e6);
      border: 1px solid rgba(120,40,90,.12);
      overflow:hidden;
    }

    .envPocket::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(135deg, rgba(120,40,90,.08), transparent 45%),
        linear-gradient(225deg, rgba(120,40,90,.08), transparent 45%);
      clip-path: polygon(0 0, 50% 62%, 100% 0, 100% 100%, 0 100%);
      opacity:.7;
      pointer-events:none;
    }
    .envPocket::after{
      content:"";
      position:absolute; inset:0;
      clip-path: polygon(0 0, 50% 58%, 100% 0);
      border-top: 1px solid rgba(120,40,90,.16);
      opacity:.8;
      pointer-events:none;
    }

    .envFlap{
      position:absolute;
      left: 18px; right: 18px; top: 18px;
      height: 58%;
      border-radius: 18px 18px 16px 16px;
      background:
        radial-gradient(240px 160px at 50% 15%, rgba(255,255,255,.7), transparent 60%),
        linear-gradient(180deg, #fff7fb, #ffe7ef);
      border: 1px solid rgba(120,40,90,.12);
      clip-path: polygon(0 0, 50% 86%, 100% 0, 100% 100%, 0 100%);
      transform-origin: top center;
      transform: rotateX(0deg);
      transition: transform 780ms cubic-bezier(.18,.92,.18,1);
      box-shadow: 0 10px 22px rgba(0,0,0,.06);
      pointer-events:none;
    }
    .stage.open .envFlap{ transform: rotateX(-180deg); }

    .seal{
      position:absolute;
      left:50%;
      top: 64%;
      transform: translate(-50%,-50%);
      width: 44px;
      height: 44px;
      border-radius: 999px;
      display:grid;
      place-items:center;
      font-size: 20px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.7), rgba(255,95,138,.22) 45%, rgba(255,95,138,.35));
      border: 1px solid rgba(120,40,90,.18);
      box-shadow: 0 16px 30px rgba(0,0,0,.14);
      z-index: 5;
      pointer-events:none;
    }

    /* ===== LETTER ===== */
    .paper{
      position:absolute;
      left:50%;
      top:50%;
      width: min(680px, 92vw);
      height: min(720px, 78vh);
      border-radius: 28px;

      /* –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è */
      background:
        radial-gradient(240px 220px at 20% 10%, rgba(255,95,138,.10), transparent 60%),
        radial-gradient(220px 220px at 85% 20%, rgba(124,77,255,.10), transparent 60%),
        #ffffff;

      border: 1px solid rgba(42,22,48,.10);
      box-shadow: 0 22px 60px rgba(0,0,0,.22);
      overflow:hidden;

      transform: translate(-50%, 36%) scale(.985);
      opacity: 0;
      pointer-events:none;

      transition: transform 950ms cubic-bezier(.18,.92,.18,1), opacity 420ms ease;
      z-index: 5;
    }

    .stage.open .paper{
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      pointer-events:auto;
      transition-delay: 140ms;
    }

    .paperInner{ height:100%; overflow:auto; padding: 18px 18px 16px; color: var(--ink); }
    .toLine{ font-weight:950; letter-spacing:-.2px; color: rgba(42,22,48,.90); margin-bottom: 6px; }
    .paperInner h1{ margin: 6px 0 8px; font-size: clamp(22px, 3.7vw, 34px); line-height:1.12; letter-spacing:-.5px; color: var(--ink); }
    .paperInner .subtitle{ margin:0 0 12px; color: var(--inkMuted); font-size: 14px; line-height:1.65; }

    /* –±–µ–∑ —Ä–∞–º–æ–∫ */
    .note{
      margin-top:10px;
      padding:0;
      border:none;
      background:transparent;
      color: rgba(42,22,48,.88);
      line-height:1.7;
      font-size: 14px;
    }
    .sig{ margin-top:10px; color: rgba(42,22,48,.82); font-weight:900; letter-spacing:.2px; }

    .divider{
      height:1px;
      background: rgba(42,22,48,.10);
      margin: 14px 0;
    }

    /* –∫–Ω–æ–ø–∫–∏ –Ω–∏–∂–µ */
    .question{
      margin-top: 18px;
      padding: 0;
      border: none;
      background: transparent;
    }

    .q{ font-weight:950; letter-spacing:-.2px; margin:0 0 10px; font-size: 15px; color: rgba(42,22,48,.92); }

    .row{ position:relative; height: 52px; width: 100%; display:block; }
    .btn{
      appearance:none;
      border:none;
      cursor:pointer;
      border-radius: 16px;
      padding: 12px 16px;
      font-weight:950;
      user-select:none;
      white-space:nowrap;
      transition: transform .12s ease, filter .12s ease, opacity .12s ease;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.02)}
    .btn:active{transform: translateY(1px); opacity:.92}

    #yesBtn{
      position:relative;
      z-index:2;
      color: rgba(20,10,18,.92);
      background: rgba(255,255,255,1);
      box-shadow: 0 10px 26px rgba(0,0,0,.14);
      border: 1px solid rgba(0,0,0,.06);
    }
    #noBtn{
      position:absolute;
      top:0;
      left:0;
      z-index:1;
      background: rgba(42,22,48,.07);
      color: rgba(42,22,48,.88);
      border: 1px solid rgba(42,22,48,.12);
      box-shadow:none;
      touch-action: manipulation;
    }

    @media (max-width: 520px), (pointer: coarse){
      .row{ height:auto; display:flex; gap:10px; flex-wrap:wrap; }
      #noBtn{ position:relative; left:0!important; top:0!important; }
      .stage.open .envelopeWrap{
        transform: translate(-50%,-50%) translate3d(0, calc(50vh - 160px), 0) scale(.98) rotate(0deg);
      }
    }

    
    @supports (height: 100dvh){
      .paper{ height: min(720px, 78dvh); }
      .stage.open .envelopeWrap{
        transform: translate(-50%,-50%) translate3d(0, calc(50dvh - 180px), 0) scale(.98) rotate(0deg);
      }
    }

@media (prefers-reduced-motion: reduce){
      .stage.isArriving .catWrap,
      .stage.isArriving .envelopeWrap{ animation: none; }
      .stage.isArriving .catSvg,
      .stage.arrived:not(.delivered) .catSvg{ animation: none; }
      .leg, .tail{ animation:none!important; }
      .h{ animation:none; opacity:.2; }
      .envelopeWrap, .catWrap, .envFlap, .paper{ transition: none; }
    }
  </style>
</head>

<body>
  <canvas id="confetti"></canvas>
  <div class="hearts" id="hearts"></div>

  <div class="wrap">
    <div class="stage isArriving" id="stage">

      <!-- CAT -->
      <div class="catWrap">
        <button class="catBtn" id="catBtn" type="button" aria-label="–ö–æ—Ç–∏–∫">
          <svg class="catSvg" viewBox="0 0 340 240" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <ellipse cx="170" cy="214" rx="105" ry="18" fill="rgba(0,0,0,.12)"/>

            <path class="tail" d="M258 142 C310 150, 314 106, 276 92 C304 104, 302 150, 270 160"
                  fill="none" stroke="rgba(255,255,255,.92)" stroke-width="16" stroke-linecap="round"/>

            <ellipse cx="190" cy="150" rx="96" ry="66" fill="rgba(255,255,255,.92)"/>
            <ellipse cx="198" cy="162" rx="76" ry="50" fill="rgba(255,255,255,.72)" opacity=".55"/>

            <g class="leg a"><rect x="138" y="176" width="26" height="40" rx="12" fill="rgba(255,255,255,.92)"/></g>
            <g class="leg b"><rect x="168" y="176" width="26" height="40" rx="12" fill="rgba(255,255,255,.92)"/></g>
            <g class="leg b"><rect x="214" y="176" width="26" height="40" rx="12" fill="rgba(255,255,255,.92)"/></g>
            <g class="leg a"><rect x="244" y="176" width="26" height="40" rx="12" fill="rgba(255,255,255,.92)"/></g>

            <g>
              <circle cx="108" cy="124" r="52" fill="rgba(255,255,255,.92)"/>
              <path d="M78 100 L58 62 L98 82 Z" fill="rgba(255,255,255,.92)"/>
              <path d="M126 82 L164 62 L150 100 Z" fill="rgba(255,255,255,.92)"/>
              <path d="M80 96 L66 72 L92 86 Z" fill="rgba(255,95,138,.34)"/>
              <path d="M128 86 L152 72 L144 96 Z" fill="rgba(255,95,138,.34)"/>

              <circle cx="90" cy="126" r="6.2" fill="rgba(42,22,48,.86)"/>
              <g>
                <circle class="eyeRopen" cx="128" cy="126" r="6.2" fill="rgba(42,22,48,.86)"/>
                <path class="eyeRclosed" d="M118 126 Q128 118 138 126" stroke="rgba(42,22,48,.86)" stroke-width="4" fill="none" stroke-linecap="round"/>
              </g>

              <ellipse cx="78" cy="144" rx="12" ry="7" fill="rgba(255,95,138,.26)"/>
              <ellipse cx="142" cy="144" rx="12" ry="7" fill="rgba(255,95,138,.26)"/>

              <path d="M110 136 L104 144 L116 144 Z" fill="rgba(255,95,138,.55)"/>
              <path d="M110 144 C104 152, 96 152, 92 148" stroke="rgba(42,22,48,.7)" stroke-width="3" fill="none" stroke-linecap="round"/>
              <path d="M110 144 C116 152, 124 152, 128 148" stroke="rgba(42,22,48,.7)" stroke-width="3" fill="none" stroke-linecap="round"/>

              <path d="M58 140 L30 134" stroke="rgba(42,22,48,.42)" stroke-width="3" stroke-linecap="round"/>
              <path d="M58 152 L28 156" stroke="rgba(42,22,48,.42)" stroke-width="3" stroke-linecap="round"/>
              <path d="M160 140 L188 134" stroke="rgba(42,22,48,.42)" stroke-width="3" stroke-linecap="round"/>
              <path d="M160 152 L190 156" stroke="rgba(42,22,48,.42)" stroke-width="3" stroke-linecap="round"/>
            </g>

            <path d="M210 140
                     C210 130, 226 130, 226 142
                     C226 130, 242 130, 242 142
                     C242 160, 226 170, 226 170
                     C226 170, 210 160, 210 142 Z"
                  fill="rgba(255,95,138,.52)"/>
          </svg>
        </button>
      </div>

      <!-- LETTER -->
      <div class="paper" id="paper" aria-label="–ü–∏—Å—å–º–æ">
        <div class="paperInner">
          <div class="toLine" id="toName">–î–ª—è —Ç–µ–±—è</div>

          <h1 id="headline">–ú–æ—è –º–∞–ª–µ–Ω—å–∫–∞—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíó</h1>
          <p class="subtitle" id="subtitle">
            –ò–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏, —á—Ç–æ–±—ã —Å–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ: <b>—Ç—ã –≤–∞–∂–µ–Ω(–≤–∞–∂–Ω–∞)</b> –¥–ª—è –º–µ–Ω—è.
          </p>

          <div class="note">
            <div id="noteText">
              –°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å. –Ø –ª—é–±–ª—é —Ç–æ, –∫–∞–∫ —Ç—ã —É–ª—ã–±–∞–µ—à—å—Å—è, –∫–∞–∫ —Ç—ã —Å–º–µ—ë—à—å—Å—è, –∏ –∫–∞–∫ —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º—è–≥—á–µ.
              <br><br>
              –î–∞–≤–∞–π —É—Å—Ç—Ä–æ–∏–º —Å–∞–º–æ–µ —Ç—ë–ø–ª–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ ‚Äî –ø—Ä–æ—Å—Ç–æ –º—ã, –Ω–µ–º–Ω–æ–≥–æ –º—É–∑—ã–∫–∏, —á–∞–π/–∫–æ—Ñ–µ –∏ –ø—Ä–æ–≥—É–ª–∫–∞.
            </div>
            <div class="sig" id="signature">‚Äî –¢–≤–æ–π(–¢–≤–æ—è) ‚ú®</div>
          </div>

          <div class="divider"></div>

          <div class="question">
            <div class="q" id="questionText">–ü–æ–π–¥—ë—à—å —Å–æ –º–Ω–æ–π –Ω–∞ —Å–≤–∏–¥–∞–Ω–∏–µ?</div>
            <div class="row" id="btnArena">
              <button class="btn" id="yesBtn" type="button">–î–∞ üíû</button>
              <button class="btn" id="noBtn" type="button">–ù–µ—Ç üôà</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ENVELOPE -->
      <div class="envelopeWrap" id="envelopeWrap">
        <div class="envelope" id="envelope" role="button" tabindex="0" aria-label="–ö–æ–Ω–≤–µ—Ä—Ç">
          <div class="envBack"></div>
          <div class="envPocket"></div>
          <div class="envFlap"></div>
          <div class="seal" aria-hidden="true">üíó</div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // ====== –ë–´–°–¢–†–û –ú–ï–ù–Ø–¢–¨ –¢–ï–ö–°–¢ –¢–£–¢ ======
    const CONFIG = {
      toName: "–ê–Ω—è",
      toNameFor: "–ê–Ω–∏",
      fromName: "–ú–∏—à–∞",
      headline: "–ú–æ—è –º–∞–ª–µ–Ω—å–∫–∞—è –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíó",
      subtitle: "–ò–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏, —á—Ç–æ–±—ã —Å–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ: —Ç—ã –≤–∞–∂–Ω–∞ –¥–ª—è –º–µ–Ω—è.",
      noteText:
        "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å. –Ø –æ—á–µ–Ω—å —Ä–∞–¥ —á—Ç–æ –≤—Å—Ç—Ä–µ—Ç–∏–ª —Ç–µ–±—è. –Ø –ª—é–±–ª—é —Ç–æ, –∫–∞–∫ —Ç—ã —É–ª—ã–±–∞–µ—à—å—Å—è, –∫–∞–∫ —Ç—ã —Å–º–µ—ë—à—å—Å—è, –∏ –∫–∞–∫ —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —è—Ä—á–µ." +
        "<br><br>–î–∞–≤–∞–π —É—Å—Ç—Ä–æ–∏–º —Å–∞–º–æ–µ —Ç—ë–ø–ª–æ–µ —Å–≤–∏–¥–∞–Ω–∏–µ",
      question: "–ü–æ–π–¥—ë—à—å —Å–æ –º–Ω–æ–π –Ω–∞ —Å–≤–∏–¥–∞–Ω–∏–µ?",
    };

    const $ = (id) => document.getElementById(id);

    const isTouchLayout = () => window.matchMedia("(pointer: coarse)").matches || window.matchMedia("(max-width: 520px)").matches;

    $("toName").textContent = `–î–ª—è ${CONFIG.toNameFor}`;
    $("headline").textContent = CONFIG.headline;
    $("subtitle").innerHTML = CONFIG.subtitle;
    $("noteText").innerHTML = CONFIG.noteText;
    $("signature").textContent = `‚Äî ${CONFIG.fromName} ‚ú®`;
    $("questionText").textContent = CONFIG.question;

    const stage = $("stage");
    const catBtn = $("catBtn");
    const envelope = $("envelope");

    // state: arriving -> ready -> delivered -> open
    let state = "arriving";
    const ARRIVE_MS = 4200;

    // —Ç—Ä–µ–∫–∏–Ω–≥ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–∑–∏—Ü–∏–∏ –∫—É—Ä—Å–æ—Ä–∞/–ø–∞–ª—å—Ü–∞
    let lastPointer = { x: window.innerWidth / 2, y: window.innerHeight / 2 };
    window.addEventListener("pointermove", (e) => { lastPointer = { x: e.clientX, y: e.clientY }; }, { passive:true });
    window.addEventListener("pointerdown", (e) => { lastPointer = { x: e.clientX, y: e.clientY }; }, { passive:true });

    setTimeout(() => {
      stage.classList.remove("isArriving");
      stage.classList.add("arrived");
      state = "ready";
      scheduleIdleWinks();
    }, ARRIVE_MS);

    function winkNow(){
      stage.classList.add("wink");
      setTimeout(() => stage.classList.remove("wink"), 240);
    }

    let winkTimer;
    function scheduleIdleWinks(){
      clearInterval(winkTimer);
      winkTimer = setInterval(() => {
        if (state === "ready") winkNow();
      }, 4200);
    }

    function ensureArrivedNow(){
      if (state === "arriving") {
        stage.classList.remove("isArriving");
        stage.classList.add("arrived");
        state = "ready";
        scheduleIdleWinks();
      }
    }

    function deliverOnly(){
      if (state === "delivered" || state === "open") return;
      ensureArrivedNow();
      stage.classList.add("delivered");
      state = "delivered";
      winkNow();
    }

    function openLetter(){
      if (state !== "delivered" && state !== "open") return;
      stage.classList.add("open");
      state = "open";
      burstConfetti(150);

      requestAnimationFrame(() => {
        placeNoSafelyRight();
        maybeDodgeUnderPointer(lastPointer.x, lastPointer.y);
      });
    }

    function closeLetter(){
      stage.classList.remove("open");
      state = "delivered";
      burstConfetti(90);
    }

    // –∫–æ—Ç–∏–∫: —Ç–æ–ª—å–∫–æ ‚Äú–æ—Ç–¥–∞—Ç—å‚Äù
    function onCatClick(){
      if (state === "arriving") ensureArrivedNow();
      if (state === "ready") deliverOnly();
      else winkNow();
    }
    catBtn.addEventListener("click", onCatClick);
    catBtn.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); onCatClick(); }
    });

    // –∫–æ–Ω–≤–µ—Ä—Ç: –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ
    function onEnvelopeClick(){
      if (state === "arriving") ensureArrivedNow();

      if (state === "ready") {
        deliverOnly();
        setTimeout(openLetter, 520);
        return;
      }
      if (state === "delivered") { openLetter(); return; }
      if (state === "open") { closeLetter(); return; }
    }
    envelope.addEventListener("click", onEnvelopeClick);
    envelope.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); onEnvelopeClick(); }
      if (e.key === "Escape") { e.preventDefault(); closeLetter(); }
    });

    // ====== hearts ======
    const hearts = $("hearts");
    const heartChars = ["üíó","üíñ","üíò","üíù","üíì","üíû","‚ù§Ô∏è"];
    function spawnHeart(){
      const el = document.createElement("div");
      el.className = "h";
      el.textContent = heartChars[Math.floor(Math.random()*heartChars.length)];
      const left = Math.random()*100;
      const dur = 7 + Math.random()*7;
      const dx = (Math.random()*2-1) * 40;
      const size = 14 + Math.random()*18;

      el.style.left = left + "vw";
      el.style.fontSize = size + "px";
      el.style.animationDuration = dur + "s";
      el.style.setProperty("--dx", dx + "vw");
      el.style.animationDelay = (Math.random()*0.6) + "s";

      hearts.appendChild(el);
      setTimeout(()=>el.remove(), dur*1000 + 1200);
    }
    setInterval(spawnHeart, 420);
    for(let i=0;i<10;i++) setTimeout(spawnHeart, i*160);

    // ====== buttons ======
    const yesBtn = $("yesBtn");
    const noBtn  = $("noBtn");
    const arena  = $("btnArena");

    yesBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      burstConfetti(360);
      toast(`–£—Ä–∞! üíû`);
    });

    function placeNoSafelyRight(){
      if (state !== "open") return;
      if (isTouchLayout()) return;

      const a = arena.getBoundingClientRect();
      const y = yesBtn.getBoundingClientRect();
      const nW = noBtn.offsetWidth;

      const gap = 12;
      const left = Math.max(0, Math.min(a.width - nW, (y.right - a.left) + gap));
      noBtn.style.left = left + "px";
      noBtn.style.top = "0px";
    }
    window.addEventListener("resize", placeNoSafelyRight);

    let dodges = 0;
    function dodge(){
      if (state !== "open") return;
      if (isTouchLayout()) return;

      dodges++;
      const maxDodges = 6;

      if(dodges > maxDodges){
        noBtn.textContent = "–õ–∞–¥–Ω–æ‚Ä¶ –¥–∞ üò≥";
        noBtn.style.background = "rgba(255,255,255,1)";
        noBtn.style.color = "rgba(20,10,18,.92)";
        noBtn.style.border = "1px solid rgba(0,0,0,.06)";
        noBtn.onclick = () => yesBtn.click();
        return;
      }

      const a = arena.getBoundingClientRect();
      const y = yesBtn.getBoundingClientRect();

      const nW = noBtn.offsetWidth;
      const nH = noBtn.offsetHeight;

      const maxX = Math.max(0, a.width - nW);
      const maxY = Math.max(0, a.height - nH);

      const pad = 12;
      const forbidL = Math.max(0, (y.left - a.left) - (nW + pad));
      const forbidR = Math.min(maxX, (y.right - a.left) + pad);

      let x;
      if (forbidR - forbidL >= maxX - 2) {
        x = maxX;
      } else {
        const leftSpan = Math.max(0, forbidL);
        const rightSpan = Math.max(0, maxX - forbidR);
        const pick = Math.random() * (leftSpan + rightSpan);
        x = (pick < leftSpan) ? pick : (forbidR + (pick - leftSpan));
      }

      const yOffset = maxY > 0 ? Math.random() * Math.min(8, maxY) : 0;
      noBtn.style.left = Math.round(x) + "px";
      noBtn.style.top  = Math.round(yOffset) + "px";
    }

    // —Ñ–∏–∫—Å ‚Äú–ø–µ—Ä–≤–æ–≥–æ –Ω–∞–≤–µ–¥–µ–Ω–∏—è‚Äù
    let dodgeCooldownUntil = 0;
    function maybeDodgeUnderPointer(x, y){
      if (state !== "open") return;
      if (isTouchLayout()) return;

      const now = performance.now();
      if (now < dodgeCooldownUntil) return;

      const r = noBtn.getBoundingClientRect();
      const inside = x >= r.left && x <= r.right && y >= r.top && y <= r.bottom;

      if (inside) {
        dodgeCooldownUntil = now + 220;
        dodge();
      }
    }

    window.addEventListener("pointermove", (e) => {
      lastPointer = { x: e.clientX, y: e.clientY };
      maybeDodgeUnderPointer(e.clientX, e.clientY);
    }, { passive:true });

    noBtn.addEventListener("pointerenter", (e) => { e.stopPropagation(); dodge(); });
    noBtn.addEventListener("pointerdown", (e) => { e.preventDefault(); e.stopPropagation(); dodge(); });
    noBtn.addEventListener("click", (e) => { e.preventDefault(); e.stopPropagation(); dodge(); });

    // ====== toast ======
    let toastEl;
    function toast(msg){
      if(!toastEl){
        toastEl = document.createElement("div");
        toastEl.style.position = "fixed";
        toastEl.style.left = "50%";
        toastEl.style.bottom = "22px";
        toastEl.style.transform = "translateX(-50%)";
        toastEl.style.padding = "12px 14px";
        toastEl.style.borderRadius = "14px";
        toastEl.style.background = "rgba(0,0,0,.40)";
        toastEl.style.border = "1px solid rgba(255,255,255,.18)";
        toastEl.style.color = "rgba(255,255,255,.92)";
        toastEl.style.backdropFilter = "blur(10px)";
        toastEl.style.zIndex = "7";
        toastEl.style.boxShadow = "0 14px 40px rgba(0,0,0,.22)";
        toastEl.style.maxWidth = "min(520px, 92vw)";
        toastEl.style.textAlign = "center";
        toastEl.style.fontWeight = "900";
        toastEl.style.opacity = "0";
        toastEl.style.transition = "opacity .18s ease, transform .18s ease";
        document.body.appendChild(toastEl);
      }
      toastEl.textContent = msg;
      toastEl.style.opacity = "1";
      toastEl.style.transform = "translateX(-50%) translateY(-2px)";
      clearTimeout(toastEl._t);
      toastEl._t = setTimeout(()=>{
        toastEl.style.opacity = "0";
        toastEl.style.transform = "translateX(-50%) translateY(4px)";
      }, 2400);
    }

    // ====== confetti ======
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    let W,H,particles=[],raf;

    function resize(){
      W = canvas.width = window.innerWidth * devicePixelRatio;
      H = canvas.height = window.innerHeight * devicePixelRatio;
    }
    window.addEventListener("resize", resize);
    resize();

    function burstConfetti(n=160){
      const now = performance.now();
      for(let i=0;i<n;i++){
        particles.push({
          x: (window.innerWidth * (0.22 + Math.random()*0.56)) * devicePixelRatio,
          y: (window.innerHeight * (0.22 + Math.random()*0.56)) * devicePixelRatio,
          vx: (Math.random()*2-1) * 8 * devicePixelRatio,
          vy: (Math.random()*-1.2 - 0.2) * 10 * devicePixelRatio,
          g: (0.32 + Math.random()*0.18) * devicePixelRatio,
          r: (4 + Math.random()*5) * devicePixelRatio,
          a: 1,
          rot: Math.random()*Math.PI*2,
          vr: (Math.random()*2-1)*0.18,
          born: now
        });
      }
      if(!raf) tick();
    }

    function tick(){
      raf = requestAnimationFrame(tick);
      ctx.clearRect(0,0,W,H);
      const t = performance.now();
      particles = particles.filter(p => (t - p.born) < 2200 && p.a > 0.02);

      for(const p of particles){
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        p.a *= 0.985;

        ctx.save();
        ctx.globalAlpha = Math.max(0, Math.min(1, p.a));
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);

        const hue = (t/18 + p.x/30) % 360;
        ctx.fillStyle = `hsl(${hue}, 90%, 70%)`;

        const r = p.r;
        ctx.beginPath();
        ctx.moveTo(0, -r);
        ctx.lineTo(r, 0);
        ctx.lineTo(0, r);
        ctx.lineTo(-r, 0);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      }

      if(particles.length === 0){
        cancelAnimationFrame(raf);
        raf = null;
        ctx.clearRect(0,0,W,H);
      }
    }

    setTimeout(()=>burstConfetti(60), 900);
  </script>
</body>
</html>
